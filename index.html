<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>KFZ‑Gutachten – Sammel‑Upload</title>
  <style>
    :root{--bg:#0f1115;--card:#161923;--muted:#23283a;--text:#e9edf1;--accent:#4cc9f0}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:1000px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;background:rgba(15,17,21,.75);backdrop-filter:saturate(160%) blur(8px);border-bottom:1px solid #1d2233}
    h1{margin:0;padding:14px 24px;font-size:20px}
    .grid{display:grid;gap:12px}
    .g2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .g3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:720px){.g2{grid-template-columns:1fr}.g3{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid #1d2233;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .pad{padding:14px}
    .muted{background:var(--muted);color:#b9c2d0}
    input,button,textarea{width:100%;border:1px solid #1d2233;background:#0f1422;color:var(--text);padding:12px;border-radius:12px}
    input::placeholder,textarea::placeholder{color:#93a0b4}
    button{cursor:pointer;background:linear-gradient(180deg,#2a6df8,#2456c7);border:none;font-weight:600}
    button[disabled]{opacity:.55;cursor:not-allowed}
    .thumbs{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px}
    .thumb{position:relative;border-radius:12px;overflow:hidden;border:1px solid #1d2233;background:#0f1422}
    .thumb img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block}
    .thumb b{position:absolute;left:6px;bottom:6px;background:rgba(0,0,0,.5);padding:2px 6px;border-radius:6px;font-size:12px}
    .status{margin-top:8px;font-size:14px;min-height:22px}
  </style>
</head>
<body>
  <header><h1>KFZ‑Gutachten – Sammel‑Upload</h1></header>
  <div class="container grid" style="gap:22px">
    <section class="card pad">
      <h2 style="margin-top:0">Sammel‑Upload (empfohlen)</h2>
      <p>Fotografiere dein Fahrzeug und Unterlagen (Fahrzeugschein, Schadenübersichten, Detailfotos). Lade hier deine Bilder hoch. <br>Mit den Angaben unten können wir deinen Vorgang eindeutig zuordnen.</p>

      <h3>Angaben zum Vorgang</h3>
      <div class="grid g2">
        <input id="nameInput" placeholder="Vollständiger Name (Pflicht)">
        <input id="phoneInput" placeholder="Telefon (für Rückruf)">
        <input id="emailInput" placeholder="E‑Mail (optional)">
        <input id="licenseInput" placeholder="Kennzeichen (optional)">
        <input id="dateInput" type="date" placeholder="Unfall‑Datum">
        <input id="placeInput" placeholder="Unfall‑Ort (Straße, Ort)">
      </div>

      <h3 style="margin-top:16px">Fotos auswählen</h3>
      <input id="fileInput" type="file" accept="image/*" multiple>
      <div id="thumbs" class="thumbs" aria-live="polite" style="margin-top:12px"></div>

      <h3 style="margin-top:16px">Fotovorlage (Beispiele)</h3>
      <div class="grid g3">
        <div class="card pad muted">Übersicht – vorne links</div>
        <div class="card pad muted">Übersicht – vorne rechts</div>
        <div class="card pad muted">Übersicht – hinten links</div>
        <div class="card pad muted">Übersicht – hinten rechts</div>
        <div class="card pad muted">Fahrzeugschein – Vorderseite</div>
        <div class="card pad muted">Fahrzeugschein – Rückseite</div>
        <div class="card pad muted">Fahrgestellnummer (FIN)</div>
        <div class="card pad muted">Reifengröße & Hersteller</div>
        <div class="card pad muted">Tacho / Kilometerstand</div>
        <div class="card pad muted">Schaden – Übersicht</div>
        <div class="card pad muted">Schaden – Detail / Nahaufnahme</div>
        <div class="card pad muted">Übergang zwischen Bauteilen</div>
      </div>

      <div class="grid g2" style="margin-top:16px">
        <button id="sendBtn" disabled>Bilder & Angaben senden</button>
        <div class="status" id="status"></div>
      </div>
    </section>
  </div>

  <script>
    const API_URL = "https://boulehris-mail-connect.onrender.com/upload";

    const fileInput = document.getElementById('fileInput');
    const thumbs = document.getElementById('thumbs');
    const sendBtn = document.getElementById('sendBtn');
    const statusBox = document.getElementById('status');

    const nameInput = document.getElementById('nameInput');
    const phoneInput = document.getElementById('phoneInput');
    const emailInput = document.getElementById('emailInput');
    const dateInput = document.getElementById('dateInput');
    const placeInput = document.getElementById('placeInput');
    const licenseInput = document.getElementById('licenseInput');

    const MAX_FILES = 25;
    const MAX_MB = 10;
    const ALLOWED = new Set(['image/jpeg','image/png','image/webp','image/heic','image/heif']);

    const updateSendState = () => {
      const hasFiles = (fileInput.files || []).length > 0;
      const hasName = (nameInput.value || "").trim().length > 1;
      sendBtn.disabled = !(hasFiles && hasName);
    };

    function previewFiles(list){
      thumbs.innerHTML = "";
      const files = Array.from(list||[]);
      for (const f of files){
        const url = URL.createObjectURL(f);
        const el = document.createElement('div');
        el.className = 'thumb';
        el.innerHTML = '<img src="'+url+'" alt="Ausgewähltes Foto"><b>'+ (f.name || 'Bild') +'</b>';
        thumbs.appendChild(el);
      }
    }

    function validateFiles(list){
      const files = Array.from(list||[]);
      if (!files.length) return {ok:false, msg:'Bitte wähle mindestens 1 Foto.'};
      if (files.length > MAX_FILES) return {ok:false, msg:'Maximal '+MAX_FILES+' Bilder.'};
      for (const f of files){
        if (!ALLOWED.has(f.type)) return {ok:false, msg:'Nicht erlaubter Typ: '+f.type};
        if (f.size > MAX_MB*1024*1024) return {ok:false, msg:f.name+' ist größer als '+MAX_MB+' MB.'};
      }
      return {ok:true, files};
    }

    fileInput.addEventListener('change', () => {
      const res = validateFiles(fileInput.files);
      if (!res.ok){ statusBox.textContent = res.msg; fileInput.value = ""; thumbs.innerHTML=""; sendBtn.disabled = true; return; }
      previewFiles(fileInput.files);
      statusBox.textContent = "";
      updateSendState();
    });

    nameInput.addEventListener('input', updateSendState);

    sendBtn.addEventListener('click', async () => {
      const res = validateFiles(fileInput.files);
      if (!res.ok){ statusBox.textContent = res.msg; return; }

      const name = (nameInput.value || "").trim();
      if (!name){ statusBox.textContent = "Bitte gib deinen vollständigen Namen an."; return; }

      const fd = new FormData();
      for (const f of res.files) fd.append('files', f, f.name);
      fd.append('name', name);
      fd.append('phone', (phoneInput.value||"").trim());
      fd.append('email', (emailInput.value||"").trim());
      fd.append('accident_date', (dateInput.value||"").trim());
      fd.append('accident_place', (placeInput.value||"").trim());
      fd.append('license_plate', (licenseInput.value||"").trim());
      fd.append('message', 'Upload aus dem Sammel‑Upload');

      sendBtn.disabled = true;
      const old = sendBtn.textContent;
      sendBtn.textContent = "Sende …";
      statusBox.textContent = "";

      try{
        const r = await fetch(API_URL, { method:'POST', body: fd });
        if (!r.ok){
          const txt = await r.text().catch(()=>'');
          throw new Error('Serverfehler ('+r.status+'): '+txt);
        }
        const data = await r.json().catch(()=>({ok:true}));
        if (data && (data.ok || data.success)){
          statusBox.textContent = "Danke! Deine Bilder und Angaben wurden gesendet.";
          fileInput.value = "";
          thumbs.innerHTML = "";
          updateSendState();
        } else {
          throw new Error('Antwort konnte nicht bestätigt werden.');
        }
      } catch(err){
        statusBox.textContent = "Fehler beim Senden: "+ err.message;
      } finally{
        sendBtn.textContent = old;
        updateSendState();
      }
    });
  </script>
</body>
</html>
